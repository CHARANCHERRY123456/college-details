<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/jpeg" href="download.jpeg">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"> -->
    <title>RKVBros</title>
    <!-- <link rel="stylesheet" href="../public/home.css"> -->
    <link rel="stylesheet" href="/home.css">

</head>
<body>
    <%- include('navbar.ejs')  %>
    <div class="body">
        <% if(locals.email && locals.email == "rr200589@rguktrkv.ac.in"){ %>
            <div class="nav">
                <a href="charan/get_users">Get User</a>
                <a href="charan/get_search_data">Get Search Data</a>
                <a href="charan/get_friends">Get Friends</a>
                <form action="/add_friend"  method="post">
                    <input type="text" name="email">
                    <input type="submit" placeholder="add_friend">
                </form>
            </div>
        <% } %> 
        <!-- For all  -->
        <!-- <div class="search-box">
            <p id="pre_text" style="color: black;"> Use suggestions to search for a name </p>
            <input list="suggestedNames" type="text" id="searchInput" name="name" placeholder="Search a name" autocomplete="off">
            <datalist id="suggestedNames">
                <option value="names">names</option>
            </datalist>
            <button id="submit_bro" onclick="get_id()">submit</button>
        </div> -->
        
        <div id="result" class="container"></div>
        <div id="footer">

        </div>
    </div>

    <script>
       const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', async () => {
            const query = searchInput.value;
            try {
                const response = await fetch(`/search?name=${query}`);
                const suggestions = await response.json();
                console.log("suggestions = " , suggestions);
                const selectElement = document.getElementById("suggestedNames");
                selectElement.innerHTML = '';
                if (Array.isArray(suggestions.names)) {
                    suggestions.names.forEach(name => {
                        const option = document.createElement('option');
                        option.value = name;
                        option.textContent = name;
                        selectElement.appendChild(option);
                    });
                } else {
                    console.error('Expected names to be an array but got:', suggestions.names);
                }
            } catch (error) {
                console.error('Error fetching or processing data:', error);
            }
        });

        async function get_id(){
            const name = searchInput.value;
            console.log("searched for " , name);
            const response = await fetch(`/get_id?name=${name}`);
            const data = await response.json();
            console.log(data);
            document.getElementById("pre_text").style.display = "none"
            if(data.success == false) {
                document.getElementById('result').innerHTML = "Sorry You can only see other public users if you are a public user for the privacy issues try searching other users if they are public"
            }
            else{
            document.getElementById('result').innerHTML = `
                <div class="photo">
                    <img src="${data.IMAGE[0]}" alt="User Image" id="userImage" class="img-fluid image">
                    <h2>${data.NAME[0]}</h2>
                    <p><span class="label"><strong>ID:</strong> ${data.ID[0]}</span></p>
                    <p><span class="label"><strong>Phone:</strong> ${data.PHONE[0]}</span></p>
                    <p><span class="label"><strong>CGPA:</strong> ${data.CGPA[0]}</span></p>
                    <p><span class="label"><strong>B_RANK:</strong> ${data.RANK[0]}</span></p>
                    <p><span class="label"><strong>Branch:</strong> ${data.BRANCH[0]}</span></p>
                    <p><span class="label"><strong>Date of Birth:</strong> ${data.DOB[0]}</span></p>
                </div>
                <div class="details">
                    <p><span class="label"><strong>Gender:</strong> ${data.GENDER[0]}</span></p>
                    <p><span class="label"><strong>Caste:</strong> ${data.CASTE[0]}</span></p>
                    <p><span class="label"><strong>District:</strong> ${data.DISTRICT[0]}</span></p>
                    <p><span class="label"><strong>Father:</strong> ${data.FATHER[0]}</span></p>
                    <p><span class="label"><strong>MOTHER:</strong> ${data.MOTHER[0]}</span></p>
                    <p><span class="label"><strong>Mandal:</strong> ${data.MANDAL[0]}</span></p>
                    <p><span class="label"><strong>CET HT NO.:</strong> ${data['CET HT NO.'][0]}</span></p>
                    <p><span class="label"><strong>School:</strong> ${data.SCHOOL[0]}</span></p>
                    <p><span class="label"><strong>SSC HT:</strong> ${data.SSC[0]}</span></p>
                    <p><span class="label"><strong>Parent PhNo:</strong> ${data.PARENT[0]}</span></p>
                    <p><span class="label"><strong>Adress :</strong> ${data.ADDRESS[0]}</span></p>
                    <p><span class="label"><strong>e1sem1:</strong> ${data.E1SEM1[0]}</span></p>
                    <p><span class="label"><strong>e1sem2:</strong> ${data.E1SEM2[0]}</span></p>
                    <p><span class="label"><strong>e2sem1:</strong> ${data.E2SEM1[0]}</span></p>
                    <p><span class="label"><strong>e2sem2:</strong> ${data.E2SEM2[0]}</span></p>
            </div>
            `;
       } }
    </script>
</body>
</html>